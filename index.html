<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ | ครูหนึ่งรถสวย</title>
  <meta name="description" content="รวมรถมือสอง รถบ้านฟรีดาวน์ เชียงใหม่ รถสวยเกรดเอ อัปเดตรถใหม่ทุกวัน รถมือสองเชียงใหม่รูปภาพชัด รถบ้านคุณภาพดีทั่วภาคเหนือ">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- SEO/OG/Schema ใส่มาครบ -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {background:#fafafa;font-family:'Kanit',sans-serif;}
    .car-card {border-radius:16px;box-shadow:0 2px 8px #0001;overflow:hidden;background:#fff;margin-bottom:22px;}
    .car-img {width:100%;aspect-ratio:4/3;object-fit:cover;background:#e9ecef;}
    .car-title {font-weight:bold;font-size:1.15em;margin-top:8px;}
    .car-price {color:#e1412e;font-weight:bold;font-size:1.15em;}
    .car-status {margin-top:5px;background:#11c161;border-radius:7px;color:#fff;display:inline-block;padding:3px 15px;font-size:1em;}
    .car-meta {color:#666;font-size:.92em;margin-bottom:2px;}
    .pagination .page-link{border-radius:8px;margin:0 2px;}
    @media (max-width:768px){
      .car-title{font-size:1em;}
      .car-price{font-size:1em;}
    }
  </style>
</head>
<body>
<div class="container py-3">
  <h1 class="text-center mb-3 mt-2 fs-4 fw-bold">รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์<br>อัปเดตรถใหม่ทุกวัน รวมรถคุณภาพเกรด A ทั่วภาคเหนือ</h1>
  <!-- Filter Bar -->
  <div class="row mb-3 justify-content-center">
    <div class="col-12 col-md-4 mb-2">
      <select id="filter-brand" class="form-select">
        <option value="">ทุกยี่ห้อ</option>
        <option value="Toyota">Toyota</option>
        <option value="Honda">Honda</option>
        <option value="Ford">Ford</option>
        <option value="BMW">BMW</option>
        <option value="Isuzu">Isuzu</option>
        <option value="Mazda">Mazda</option>
      </select>
    </div>
    <div class="col-9 col-md-4 mb-2">
      <input id="filter-keyword" class="form-control" type="text" placeholder="ค้นหา รุ่น, สี, ปี, ราคา...">
    </div>
    <div class="col-3 col-md-2 mb-2">
      <button class="btn btn-warning w-100" onclick="applyFilters()">ค้นหา</button>
    </div>
  </div>
  <!-- Grid: Desktop 4, Mobile 2 -->
  <div class="row" id="product-list"></div>
  <nav>
    <ul class="pagination justify-content-center" id="pagination"></ul>
  </nav>
  <div class="text-center fw-bold mb-4">รวมรถทั้งหมด <span id="total-count">0</span> คัน</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const SHOPIFY_DOMAIN = "kn-goodcar.com";
const STOREFRONT_ACCESS_TOKEN = "bb70cb008199a94b83c98df0e45ada67";
const PER_PAGE = 8; // 4x2 desktop, 2x4 mobile
let allCars = [], cars = [];
let currentPage = 1;

async function fetchCars() {
  const query = `{ products(first: 100, sortKey:CREATED_AT, reverse:true) { edges { node {
    handle title vendor updatedAt descriptionHtml
    images(first:5){edges{node{url}}}
    variants(first:1){edges{node{price{amount}}}}
  }}}}`;
  const res = await fetch(`https://${SHOPIFY_DOMAIN}/api/2023-10/graphql.json`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-Shopify-Storefront-Access-Token": STOREFRONT_ACCESS_TOKEN
    },
    body: JSON.stringify({ query })
  });
  return res.json().then(j => j.data.products.edges.map(e => e.node));
}

function carStatusTag(title) {
  if (/ขายแล้ว|sold/i.test(title)) return '<span class="car-status bg-danger">ขายแล้ว</span>';
  if (/จอง|reserved/i.test(title)) return '<span class="car-status bg-warning text-dark">จองแล้ว</span>';
  return '<span class="car-status bg-success">ฟรีดาวน์</span>';
}

function renderGrid(page = 1) {
  const list = document.getElementById('product-list');
  let shown = cars.slice((page-1)*PER_PAGE, page*PER_PAGE);
  if (!shown.length) { list.innerHTML = '<div class="col-12 text-center py-5">ไม่พบรถที่ค้นหา</div>'; return; }
  list.innerHTML = shown.map(car => `
    <div class="col-6 col-md-3 d-flex">
      <div class="car-card w-100 mb-3">
        <a href="car-detail.html?handle=${car.handle}">
          <img class="car-img" src="${car.images.edges[0]?.node.url}" alt="รถมือสอง${car.title}" loading="lazy">
        </a>
        <div class="px-3 pb-2 pt-2">
          <div class="car-title">${car.title}</div>
          <div class="car-price">฿${Number(car.variants.edges[0]?.node.price.amount||"0").toLocaleString()}</div>
          ${carStatusTag(car.title)}
          <div class="car-meta mt-1">อัปเดต: ${new Date(car.updatedAt).toLocaleDateString('th-TH')}</div>
        </div>
      </div>
    </div>
  `).join("");
  document.getElementById('total-count').textContent = cars.length;
  // Pagination
  let pages = Math.ceil(cars.length / PER_PAGE);
  let pnav = document.getElementById('pagination');
  if (pages > 1) {
    pnav.innerHTML = Array.from({length: pages}, (_,i)=>`<li class="page-item${i+1==page?' active':''}"><a class="page-link" href="#" onclick="gotoPage(${i+1});return false;">${i+1}</a></li>`).join("");
  } else {
    pnav.innerHTML = "";
  }
}
function gotoPage(p) { currentPage=p; renderGrid(p); window.scrollTo(0,0); }
function applyFilters() {
  const brand = document.getElementById('filter-brand').value.toLowerCase();
  const kw = document.getElementById('filter-keyword').value.toLowerCase();
  cars = allCars.filter(car =>
    (!brand || car.title.toLowerCase().includes(brand)) &&
    (!kw || car.title.toLowerCase().includes(kw) || car.vendor?.toLowerCase().includes(kw))
  );
  currentPage=1; renderGrid(currentPage);
}
fetchCars().then(res => { allCars = cars = res; renderGrid(1); });
</script>
</body>
</html>