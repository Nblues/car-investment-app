<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ | ครูหนึ่งรถสวย</title>
  <meta name="description" content="รวมรถบ้านฟรีดาวน์ รถมือสองเชียงใหม่ รถบ้านคุณภาพดีทั่วภาคเหนือ ลำพูน ลำปาง เชียงราย พะเยา แพร่ น่าน แม่ฮ่องสอน รถสวยเกรดA ฟรีดาวน์ ราคาถูก ผ่อนง่าย เต็นท์รถเชียงใหม่">
  <meta name="keywords" content="รถมือสองเชียงใหม่, รถบ้านฟรีดาวน์, รถยนต์มือสอง, รถบ้านเชียงราย, รถบ้านลำพูน, รถบ้านลำปาง, รถบ้านพะเยา, รถบ้านแพร่, รถบ้านน่าน, รถบ้านแม่ฮ่องสอน, รถบ้านเจ้าของขายเอง, รถเต็นท์เชียงใหม่, เต็นท์รถเชียงใหม่, รถบ้านแท้, รถมือสองราคาถูก, รถมือสองยอดนิยม, รถมือสองแนะนำ, รถบ้านเกรดA">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://kn-goodcar.com/index.html">
  <meta property="og:title" content="รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ | ครูหนึ่งรถสวย">
  <meta property="og:description" content="รวมรถบ้านฟรีดาวน์ รถมือสองเชียงใหม่ เกรดA ทั่วภาคเหนือ ฟรีดาวน์ ราคาถูก รับประกัน เช็กศูนย์ครบ">
  <meta property="og:image" content="https://kn-goodcar.com/cover.jpg">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ | ครูหนึ่งรถสวย">
  <meta name="twitter:description" content="รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ ผ่อนง่าย ฟรีดาวน์ ภาคเหนือ เต็นท์รถเชียงใหม่">
  <meta name="twitter:image" content="https://kn-goodcar.com/cover.jpg">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .car-card { border-radius: 14px; box-shadow: 0 2px 10px #0001; overflow: hidden; background: #fff;}
    .car-card img { width:100%; aspect-ratio:16/10; object-fit: cover;}
    .car-title { font-weight: bold; font-size: 1.07em; }
    .car-price { color: #d32f2f; font-size: 1.08em; font-weight: bold;}
    .car-status { font-size: 0.99em; margin-bottom: 3px;}
    .car-status.sold { color: #fff; background: #e1412e; border-radius: 7px; padding:2px 10px;}
    .car-status.booked { color: #fff; background: #f9a500; border-radius: 7px; padding:2px 10px;}
    .car-status.free { color: #fff; background: #06c755; border-radius: 7px; padding:2px 10px;}
  </style>
</head>
<body>
<div class="container py-2">
  <h1 class="my-3 text-center">รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ อัปเดตรถใหม่ทุกวัน <br>รวมรถคุณภาพเกรด A ทั่วภาคเหนือ</h1>
  <div id="product-list" class="row g-3"></div>
  <nav class="my-3 d-flex justify-content-center">
    <ul class="pagination" id="pagination"></ul>
  </nav>
  <div class="text-center mb-2 fw-bold">รวมรถทั้งหมด <span id="total-count"></span> คัน</div>
</div>
<script>
const SHOPIFY_DOMAIN = "kn-goodcar.com";  // <--- ใส่โดเมน Shopify ของคุณ
const STOREFRONT_ACCESS_TOKEN = "bb70cb008199a94b83c98df0e45ada67"; // <--- token Shopify ของคุณ
const carsPerPage = 8;
let cars = [], currentPage = 1;

// ดึงรถทั้งหมดจาก Shopify เรียงใหม่ล่าสุดไปเก่าสุด
async function fetchCarsShopify() {
  const query = `{ products(first: 100, sortKey:CREATED_AT, reverse:true) { edges { node {
    handle title vendor updatedAt createdAt
    images(first:5){edges{node{url}}}
    variants(first:1){edges{node{price{amount}}}}
    description
  }}}}`;
  const res = await fetch(`https://${SHOPIFY_DOMAIN}/api/2023-10/graphql.json`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-Shopify-Storefront-Access-Token": STOREFRONT_ACCESS_TOKEN
    },
    body: JSON.stringify({ query })
  });
  const json = await res.json();
  cars = json.data.products.edges.map(e => ({
    handle: e.node.handle,
    title: e.node.title,
    price: Number(e.node.variants.edges[0]?.node.price.amount ?? 0),
    status: (e.node.description.includes("ขายแล้ว") ? "ขายแล้ว" : (e.node.description.includes("จอง") ? "จองแล้ว" : "ฟรีดาวน์")),
    images: e.node.images.edges.map(img=>img.node.url),
    desc: e.node.description,
    brand: e.node.vendor || "",
    updatedAt: e.node.updatedAt,
    createdAt: e.node.createdAt
  }));
  // เรียงใหม่ล่าสุดไปเก่าสุด (ถ้า reverse ใน query ไม่ได้ผล)
  cars.sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt));
}

function getStatusClass(status){
  if(!status) return "";
  if(status.includes("ขาย")) return "sold";
  if(status.includes("จอง")) return "booked";
  if(status.includes("ฟรีดาวน์")) return "free";
  return "";
}
function renderPage(page=1){
  const start = (page-1)*carsPerPage;
  const carsOnPage = cars.slice(start, start+carsPerPage);
  const list = document.getElementById('product-list');
  list.innerHTML = carsOnPage.map(car=>`
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
      <div class="car-card p-2">
        <a href="car-detail.html?handle=${car.handle}" class="text-decoration-none text-dark">
          <img src="${car.images[0] || 'https://kn-goodcar.com/cover.jpg'}" alt="รถมือสอง ${car.title} เชียงใหม่ รถบ้านฟรีดาวน์ ${car.brand}" loading="lazy">
          <div class="car-title my-2">${car.title}</div>
          <div class="car-price">฿${Number(car.price).toLocaleString()}</div>
          ${car.status ? `<div class="car-status ${getStatusClass(car.status)}">${car.status}</div>` : ""}
          <div class="small text-muted">อัปเดต: ${new Date(car.updatedAt).toLocaleDateString('th-TH')}</div>
        </a>
      </div>
    </div>
  `).join('');
  document.getElementById('total-count').textContent = cars.length;
  // pagination
  const pageCount = Math.ceil(cars.length/carsPerPage);
  let pagHtml = "";
  for(let i=1; i<=pageCount; i++)
    pagHtml += `<li class="page-item ${i===page?'active':''}"><a class="page-link" href="#" onclick="gotoPage(${i});return false;">${i}</a></li>`;
  document.getElementById('pagination').innerHTML = pagHtml;
}
function gotoPage(page){
  currentPage = page;
  renderPage(page);
}
(async function(){
  await fetchCarsShopify();
  renderPage(1);
})();
</script>
</body>
</html>