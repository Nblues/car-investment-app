<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ | ครูหนึ่งรถสวย</title>
  <meta name="description" content="รวมรถมือสอง รถบ้านฟรีดาวน์ เชียงใหม่ รถสวยเกรดเอ อัปเดตรถใหม่ทุกวัน รถมือสองเชียงใหม่รูปภาพชัด รถบ้านคุณภาพดีทั่วภาคเหนือ ซื้อ-ขาย-แลกเปลี่ยน จัดไฟแนนซ์ ส่งรถทั่วไทย">
  <meta name="keywords" content="รถมือสองเชียงใหม่, รถบ้านฟรีดาวน์, รถมือสองรูปภาพ, รถบ้านเชียงใหม่, รถยนต์มือสอง, รถมือสองภาคเหนือ, รถเต็นท์เชียงใหม่, รถบ้านเชียงราย, รถบ้านลำพูน, รถบ้านลำปาง, รูปรถมือสอง, รถบ้านแท้, รถบ้านเจ้าของขายเอง, รถมือสองฟรีดาวน์, รถมือสองราคาถูก, รถบ้านประวัติดี, รถมือสองยอดนิยม, รถมือสองแนะนำ, รถมือสองทั่วภาคเหนือ">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://nblues.github.io/car-investment-app/">
  <meta property="og:title" content="รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ | ครูหนึ่งรถสวย">
  <meta property="og:description" content="รวมรถบ้านคุณภาพดี รถมือสองเชียงใหม่ ฟรีดาวน์ ผ่อนถูก รับประกัน อัปเดตรถใหม่ทุกวัน เช็กเครดิตออนไลน์ได้ทันที">
  <meta property="og:image" content="https://kn-goodcar.com/cover.jpg">
  <meta property="og:url" content="https://nblues.github.io/car-investment-app/">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ | ครูหนึ่งรถสวย">
  <meta name="twitter:description" content="รวมรถบ้านคุณภาพดี รถมือสองเชียงใหม่ ผ่อนถูก ฟรีดาวน์ เช็คเครดิตเร็ว">
  <meta name="twitter:image" content="https://kn-goodcar.com/cover.jpg">
  <link rel="icon" href="https://kn-goodcar.com/favicon.ico">
  <!-- preload รูปปก -->
  <link rel="preload" as="image" href="https://kn-goodcar.com/cover.jpg">
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- JSON-LD AutoDealer Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "AutoDealer",
    "name": "ครูหนึ่งรถสวย",
    "image": "https://kn-goodcar.com/cover.jpg",
    "url": "https://kn-goodcar.com/",
    "address": { "@type": "PostalAddress", "addressRegion": "เชียงใหม่", "addressCountry": "TH" },
    "telephone": "+66940649018",
    "sameAs": [
      "https://www.facebook.com/KN2car",
      "https://lin.ee/ng5yM32",
      "https://www.tiktok.com/@krunueng_usedcar",
      "https://youtube.com/@chiangraiusedcar"
    ]
  }
  </script>
  <style>
    body { background: #fafafa; font-family: 'Kanit',sans-serif; }
    .headline { font-size: 2.15em; text-align: center; margin: 30px 0 18px 0; }
    .filter-bar { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 20px; }
    .filter-bar select, .filter-bar input { font-size: 1.07em; padding: 7px 10px; border-radius: 7px; border: 1px solid #eee;}
    .car-card .card-img-top { aspect-ratio: 4/3; object-fit: cover; background: #eee; }
    .car-title { font-weight: bold; font-size: 1.08em; margin-bottom: 5px;}
    .car-price { color: #d32f2f; font-size: 1.16em; font-weight: bold; margin-bottom: 8px;}
    .badge { font-size: 1em; }
    @media (max-width: 900px){ .headline{font-size:1.2em;} }
    @media (max-width: 600px){
      .headline{font-size:1em;}
      .car-card .card-img-top { aspect-ratio: 16/11;}
    }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div class="container">
    <div class="headline">รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ อัปเดตรถใหม่ทุกวัน<br>รวมรถคุณภาพเกรด A ทั่วภาคเหนือ</div>
    <div class="filter-bar mb-3">
      <select id="filter-brand">
        <option value="">ทุกยี่ห้อ</option>
        <option value="Toyota">Toyota</option>
        <option value="Honda">Honda</option>
        <option value="Ford">Ford</option>
        <option value="BMW">BMW</option>
        <option value="Isuzu">Isuzu</option>
        <option value="Mitsubishi">Mitsubishi</option>
        <option value="Mazda">Mazda</option>
        <option value="Chevrolet">Chevrolet</option>
      </select>
      <input type="text" id="filter-keyword" placeholder="ค้นหา รุ่น, สี, ปี, ราคา..." />
      <button class="btn btn-warning px-4" onclick="applyFilters()">ค้นหา</button>
    </div>
    <div id="product-list" class="row g-3"></div>
    <div class="d-flex justify-content-between align-items-center mt-4">
      <div id="pagination" class="d-flex"></div>
      <div class="fw-bold" id="total-count"></div>
    </div>
  </div>
<script>
  // ---- CONFIG ----
  const SHOPIFY_DOMAIN = "kn-goodcar.com";
  const STOREFRONT_ACCESS_TOKEN = "bb70cb008199a94b83c98df0e45ada67";
  // Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCB-Tt_xgUy2JK33bd5E5J06SwA4y5UJ7o",
    authDomain: "catalog-all-cars.firebaseapp.com",
    databaseURL: "https://catalog-all-cars-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "catalog-all-cars",
    storageBucket: "catalog-all-cars.appspot.com",
    messagingSenderId: "674226321868",
    appId: "1:674226321868:web:908550ccd79f41e8348569",
    measurementId: "G-8RR4H4Z8Q5"
  };
  firebase.initializeApp(firebaseConfig);

  // ---- LOAD ALL ----
  let allCars = [];
  let statuses = {};
  let carsPerPage = 8;
  let page = 1;
  let filtered = [];

  async function fetchCars() {
    const query = `{ products(first: 100) { edges { node {
      handle title vendor updatedAt
      images(first:1){edges{node{url}}}
      variants(first:1){edges{node{price{amount}}}}
    }}}}`;
    const res = await fetch(`https://${SHOPIFY_DOMAIN}/api/2023-10/graphql.json`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-Shopify-Storefront-Access-Token": STOREFRONT_ACCESS_TOKEN
      },
      body: JSON.stringify({ query })
    });
    const json = await res.json();
    return json.data.products.edges.map(e => e.node);
  }

  async function fetchStatuses() {
    const snap = await firebase.database().ref('extras').once('value');
    return snap.val() || {};
  }

  async function renderCars() {
    document.getElementById('product-list').innerHTML = '<div class="text-center py-4">กำลังโหลดข้อมูล...</div>';
    allCars = await fetchCars();
    statuses = await fetchStatuses();
    filtered = allCars;
    page = 1;
    displayCars();
  }

  function displayCars() {
    const list = document.getElementById('product-list');
    if (filtered.length === 0) {
      list.innerHTML = '<div class="text-center py-4">ไม่พบรถที่ค้นหา</div>';
      document.getElementById('total-count').textContent = '';
      document.getElementById('pagination').innerHTML = '';
      return;
    }
    // Pagination
    const totalPages = Math.ceil(filtered.length / carsPerPage);
    const start = (page - 1) * carsPerPage;
    const showCars = filtered.slice(start, start + carsPerPage);

    list.innerHTML = showCars.map(car => {
      const handle = car.handle;
      const status = statuses[handle]?.status || "พร้อมขาย";
      let badge = `<span class="badge bg-info">พร้อมขาย</span>`;
      if (status.includes("จอง")) badge = `<span class="badge bg-warning text-dark">จองแล้ว</span>`;
      if (status.includes("ขาย")) badge = `<span class="badge bg-danger">ขายแล้ว</span>`;
      return `
      <div class="col-12 col-md-6 col-lg-3 d-flex">
        <div class="card h-100 shadow-sm w-100 car-card">
          <a href="car-detail.html?handle=${handle}">
            <img src="${car.images.edges[0]?.node.url || 'https://kn-goodcar.com/cover.jpg'}"
              class="card-img-top"
              alt="รถมือสอง${car.title} เชียงใหม่ ฟรีดาวน์ เจ้าของขายเอง"
              width="100%" height="188" loading="lazy">
          </a>
          <div class="card-body text-center">
            <div class="car-title">${car.title}</div>
            <div class="car-price">฿${Number(car.variants.edges[0]?.node.price.amount || "0").toLocaleString()}</div>
            <div class="mb-2">${badge}</div>
            <div class="text-muted" style="font-size:0.95em;">อัปเดต: ${new Date(car.updatedAt).toLocaleDateString('th-TH')}</div>
          </div>
        </div>
      </div>
      `;
    }).join("");
    document.getElementById('total-count').textContent = `รวมรถทั้งหมด ${filtered.length} คัน`;
    // Pagination buttons
    let pag = '';
    if (totalPages > 1) {
      for (let i = 1; i <= totalPages; i++) {
        pag += `<button class="btn btn-sm ${i===page?'btn-warning':'btn-outline-secondary'} mx-1" onclick="gotoPage(${i})">${i}</button>`;
      }
    }
    document.getElementById('pagination').innerHTML = pag;
  }

  function applyFilters() {
    const brand = document.getElementById('filter-brand').value.toLowerCase();
    const kw = document.getElementById('filter-keyword').value.toLowerCase();
    filtered = allCars.filter(car =>
      (!brand || car.title.toLowerCase().includes(brand)) &&
      (!kw || car.title.toLowerCase().includes(kw) || car.vendor?.toLowerCase().includes(kw))
    );
    page = 1;
    displayCars();
  }
  function gotoPage(p) {
    page = p;
    displayCars();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  renderCars();
</script>
</body>
</html>