<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ | ครูหนึ่งรถสวย</title>
  <meta name="description" content="รวมรถมือสอง รถบ้านฟรีดาวน์ เชียงใหม่ รถสวยเกรดเอ อัปเดตรถใหม่ทุกวัน รถมือสองเชียงใหม่รูปภาพชัด รถบ้านคุณภาพดีทั่วภาคเหนือ ซื้อ-ขาย-แลกเปลี่ยน จัดไฟแนนซ์ ส่งรถทั่วไทย">
  <meta name="keywords" content="รถมือสองเชียงใหม่, รถบ้านฟรีดาวน์, รถมือสองรูปภาพ, รถบ้านเชียงใหม่, รถยนต์มือสอง, รถมือสองภาคเหนือ, รถเต็นท์เชียงใหม่, รถบ้านเชียงราย, รถบ้านลำพูน, รถบ้านลำปาง, รูปรถมือสอง, รถบ้านแท้, รถบ้านเจ้าของขายเอง, รถมือสองฟรีดาวน์, รถมือสองราคาถูก, รถบ้านประวัติดี, รถมือสองยอดนิยม, รถมือสองแนะนำ, รถมือสองทั่วภาคเหนือ">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://nblues.github.io/car-investment-app/">
  <meta property="og:title" content="รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ | ครูหนึ่งรถสวย">
  <meta property="og:description" content="รวมรถบ้านคุณภาพดี รถมือสองเชียงใหม่ ฟรีดาวน์ ผ่อนถูก รับประกัน อัปเดตรถใหม่ทุกวัน เช็กเครดิตออนไลน์ได้ทันที">
  <meta property="og:image" content="https://kn-goodcar.com/cover.jpg">
  <meta property="og:url" content="https://nblues.github.io/car-investment-app/">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ | ครูหนึ่งรถสวย">
  <meta name="twitter:description" content="รวมรถบ้านคุณภาพดี รถมือสองเชียงใหม่ ผ่อนถูก ฟรีดาวน์ เช็คเครดิตเร็ว">
  <meta name="twitter:image" content="https://kn-goodcar.com/cover.jpg">
  <link rel="icon" href="https://kn-goodcar.com/favicon.ico">
  <link rel="preload" as="image" href="https://kn-goodcar.com/cover.jpg">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- JSON-LD AutoDealer Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "AutoDealer",
    "name": "ครูหนึ่งรถสวย",
    "image": "https://kn-goodcar.com/cover.jpg",
    "url": "https://kn-goodcar.com/",
    "address": { "@type": "PostalAddress", "addressRegion": "เชียงใหม่", "addressCountry": "TH" },
    "telephone": "+66940649018",
    "sameAs": [
      "https://www.facebook.com/KN2car",
      "https://lin.ee/ng5yM32",
      "https://www.tiktok.com/@krunueng_usedcar",
      "https://youtube.com/@chiangraiusedcar"
    ]
  }
  </script>
  <style>
    body { background: #fafafa; font-family: 'Kanit',sans-serif; }
    .headline { font-size: 2.1em; text-align: center; margin: 30px 0 20px 0; }
    .filter-bar { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 18px; }
    .filter-bar select, .filter-bar input { font-size: 1.07em; padding: 7px 10px; border-radius: 7px; border: 1px solid #eee;}
    .car-list-ak { display: grid; grid-template-columns: repeat(4, 1fr); gap: 22px; }
    @media (max-width: 1000px){ .car-list-ak{ grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 600px){ .car-list-ak{ grid-template-columns: repeat(2, 1fr);} }
    .car-ak { background: #fff; border-radius: 16px; box-shadow:0 2px 8px #0001; overflow: hidden; display: flex; flex-direction: column; min-width: 0;}
    .car-ak-img { width: 100%; aspect-ratio: 4/3; object-fit: cover; background: #eee; border-bottom:1.5px solid #f4f4f4;}
    .car-ak-info { padding: 17px 15px 12px 15px;}
    .car-ak-title { font-weight: bold; font-size: 1.05em; margin-bottom: 7px; line-height: 1.23;}
    .car-ak-price { color: #d32f2f; font-size: 1.11em; font-weight: bold; margin-bottom: 7px;}
    .car-ak-status { display:inline-block; margin-bottom:7px; padding: 4px 18px 4px 18px; border-radius:7px; font-size:1.07em; font-weight:600;}
    .car-ak-status.sold { background:#e94242; color:#fff; }
    .car-ak-status.reserve { background:#ffd84c; color:#a66b01; }
    .car-ak-status.available { background:#00b77c; color:#fff; }
    .car-ak-update { color: #888; font-size:0.96em;}
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div class="container px-2 px-md-3">
    <div class="headline">รถมือสองเชียงใหม่ รถบ้านฟรีดาวน์ อัปเดตรถใหม่ทุกวัน<br>รวมรถคุณภาพเกรด A ทั่วภาคเหนือ</div>
    <div class="filter-bar mb-3">
      <select id="filter-brand">
        <option value="">ทุกยี่ห้อ</option>
        <option value="Toyota">Toyota</option>
        <option value="Honda">Honda</option>
        <option value="Ford">Ford</option>
        <option value="BMW">BMW</option>
        <option value="Isuzu">Isuzu</option>
        <option value="Mitsubishi">Mitsubishi</option>
        <option value="Mazda">Mazda</option>
        <option value="Chevrolet">Chevrolet</option>
      </select>
      <input type="text" id="filter-keyword" placeholder="ค้นหา รุ่น, สี, ปี, ราคา..." />
      <button class="btn btn-warning px-4" onclick="applyFilters()">ค้นหา</button>
    </div>
    <div id="product-list" class="car-list-ak mb-3"></div>
    <div class="d-flex justify-content-between align-items-center mt-4 flex-wrap gap-2">
      <div id="pagination" class="d-flex flex-wrap"></div>
      <div class="fw-bold" id="total-count"></div>
    </div>
  </div>
<script>
  // ---- CONFIG ----
  const SHOPIFY_DOMAIN = "kn-goodcar.com";
  const STOREFRONT_ACCESS_TOKEN = "bb70cb008199a94b83c98df0e45ada67";
  // Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCB-Tt_xgUy2JK33bd5E5J06SwA4y5UJ7o",
    authDomain: "catalog-all-cars.firebaseapp.com",
    databaseURL: "https://catalog-all-cars-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "catalog-all-cars",
    storageBucket: "catalog-all-cars.appspot.com",
    messagingSenderId: "674226321868",
    appId: "1:674226321868:web:908550ccd79f41e8348569",
    measurementId: "G-8RR4H4Z8Q5"
  };
  firebase.initializeApp(firebaseConfig);

  let allCars = [];
  let statuses = {};
  let carsPerPage = 8;
  let page = 1;
  let filtered = [];

  async function fetchCars() {
    const query = `{ products(first: 100) { edges { node {
      handle title vendor updatedAt
      images(first:1){edges{node{url}}}
      variants(first:1){edges{node{price{amount}}}}
    }}}}`;
    const res = await fetch(`https://${SHOPIFY_DOMAIN}/api/2023-10/graphql.json`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-Shopify-Storefront-Access-Token": STOREFRONT_ACCESS_TOKEN
      },
      body: JSON.stringify({ query })
    });
    const json = await res.json();
    return json.data.products.edges.map(e => e.node);
  }

  async function fetchStatuses() {
    const snap = await firebase.database().ref('extras').once('value');
    return snap.val() || {};
  }

  async function renderCars() {
    document.getElementById('product-list').innerHTML = '<div class="text-center py-4">กำลังโหลดข้อมูล...</div>';
    allCars = await fetchCars();
    statuses = await fetchStatuses();
    filtered = allCars;
    page = 1;
    displayCars();
  }

  function displayCars() {
    const list = document.getElementById('product-list');
    if (filtered.length === 0) {
      list.innerHTML = '<div class="text-center py-4">ไม่พบรถที่ค้นหา</div>';
      document.getElementById('total-count').textContent = '';
      document.getElementById('pagination').innerHTML = '';
      return;
    }
    // Pagination
    const totalPages = Math.ceil(filtered.length / carsPerPage);
    const start = (page - 1) * carsPerPage;
    const showCars = filtered.slice(start, start + carsPerPage);

    // --- Render Grid AK Style ---
    let html = '';
    showCars.forEach(car => {
      const handle = car.handle;
      const status = (statuses[handle]?.status || "พร้อมขาย").replace(' ', '').toLowerCase();
      let badge = `<span class="car-ak-status available">ฟรีดาวน์</span>`;
      if (status.includes("จอง")) badge = `<span class="car-ak-status reserve">จองแล้ว</span>`;
      if (status.includes("ขาย")) badge = `<span class="car-ak-status sold">ขายแล้ว</span>`;
      html += `
      <div class="car-ak">
        <a href="car-detail.html?handle=${handle}">
          <img src="${car.images.edges[0]?.node.url || 'https://kn-goodcar.com/cover.jpg'}"
            class="car-ak-img"
            alt="รถมือสอง${car.title} เชียงใหม่ ฟรีดาวน์ เจ้าของขายเอง"
            width="100%" height="170" loading="lazy">
        </a>
        <div class="car-ak-info text-center">
          <div class="car-ak-title">${car.title}</div>
          <div class="car-ak-price">฿${Number(car.variants.edges[0]?.node.price.amount || "0").toLocaleString()}</div>
          <div>${badge}</div>
          <div class="car-ak-update">อัปเดต: ${new Date(car.updatedAt).toLocaleDateString('th-TH')}</div>
        </div>
      </div>
      `;
    });

    // fill empty slots (ถ้าแถวล่างไม่ครบ 2 ช่องใน mobile หรือ 4 ช่องใน desktop)
    const perRow = window.innerWidth <= 1000 ? 2 : 4;
    const mod = showCars.length % perRow;
    if (mod !== 0) {
      for (let i = 0; i < (perRow - mod); i++) html += `<div style="visibility:hidden"></div>`;
    }
    list.innerHTML = html;

    document.getElementById('total-count').textContent = `รวมรถทั้งหมด ${filtered.length} คัน`;
    // Pagination buttons
    let pag = '';
    if (totalPages > 1) {
      for (let i = 1; i <= totalPages; i++) {
        pag += `<button class="btn btn-sm ${i===page?'btn-warning':'btn-outline-secondary'} mx-1 mb-1" onclick="gotoPage(${i})">${i}</button>`;
      }
    }
    document.getElementById('pagination').innerHTML = pag;
  }

  function applyFilters() {
    const brand = document.getElementById('filter-brand').value.toLowerCase();
    const kw = document.getElementById('filter-keyword').value.toLowerCase();
    filtered = allCars.filter(car =>
      (!brand || car.title.toLowerCase().includes(brand)) &&
      (!kw || car.title.toLowerCase().includes(kw) || car.vendor?.toLowerCase().includes(kw))
    );
    page = 1;
    displayCars();
  }
  function gotoPage(p) {
    page = p;
    displayCars();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  renderCars();
</script>
</body>
</html>